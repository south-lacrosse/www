(()=>{"use strict";const e=window.wp.blockEditor,t=window.wp.blocks,l=window.wp.components,a=window.wp.element,n=window.wp.primitives,r=window.ReactJSXRuntime;var s=(0,r.jsx)(n.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,r.jsx)(n.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})}),o=(0,r.jsx)(n.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,r.jsx)(n.Path,{d:"M4 7.2v1.5h16V7.2H4zm8 8.6h8v-1.5h-8v1.5zm-8-3.5l3 3-3 3 1 1 4-4-4-4-1 1z"})});const i=JSON.parse('{"UU":"semla/contact"}'),c=(0,r.jsx)(n.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:(0,r.jsx)(n.Path,{d:"M10 9.25c-2.27 0-2.73-3.44-2.73-3.44C7 4.02 7.82 2 9.97 2c2.16 0 2.98 2.02 2.71 3.81 0 0-.41 3.44-2.68 3.44zm0 2.57L12.72 10c2.39 0 4.52 2.33 4.52 4.53v2.49s-3.65 1.13-7.24 1.13c-3.65 0-7.24-1.13-7.24-1.13v-2.49c0-2.25 1.94-4.48 4.47-4.48z"})});function m(e){return(e=e.trim()).includes(" ")?e.replace(/  +/g," "):e.replace(/^\+44(\d{4})(\d{6})$/,"+44 $1 $2").replace(/^07(\d{3})(\d{6})$/,"07$1 $2")}const u={from:[{type:"raw",isMatch:e=>{var t,l;if("P"!==e.nodeName)return!1;const a=e.innerHTML.replaceAll("<br>"," ").replace(/<a[^>]*href="(mailto|tel)[^>]*>/g,"").replaceAll("</a>","");if(a.includes("<"))return!1;const n=a.split(":");if(2!==n.length)return!1;const r=n[1],s=null!==(t=r.match(/\b[A-Za-z0-9._%+-]+\@[A-Za-z0-9._%+-]+\.[A-Za-z]+\b/g)?.length)&&void 0!==t?t:0;if(s>1)return!1;const o=null!==(l=r.match(/\b\+?\d(?: ?\d){9,12}\b/g)?.length)&&void 0!==l?l:0;return o<2&&(s>0||o>0)},transform:e=>h(e.innerHTML)},{type:"block",isMultiBlock:!0,blocks:["core/paragraph"],transform:e=>e.map(({content:e})=>h(e))},{type:"block",isMultiBlock:!0,blocks:["semla/attr-value"],transform:e=>e.map(({attr:e,value:l,sameLine:a})=>{const{text:n,email:r,tel:s}=d(l);return(0,t.createBlock)("semla/contact",{role:e,name:n,email:r,tel:s,sameLine:a})})}],to:[{type:"block",isMultiBlock:!0,blocks:["core/paragraph"],transform:e=>e.map(e=>(0,t.createBlock)("core/paragraph",{content:`${e.role}: `+x(e)}))},{type:"block",isMultiBlock:!0,blocks:["semla/attr-value"],transform:e=>e.map(e=>(0,t.createBlock)("semla/attr-value",{attr:e.role,value:x(e),sameLine:e.sameLine}))}]};function d(e){let t="",l="",a=(e=e.replace(/<br[^>]*>/g," ").replace(/<(?!a |\/a>)[^>]*>/g,"").replaceAll("&nbsp;"," ")).match(/<a href="mailto:([^"]+)"/);return a?t=a[1].trim():(a=e.match(/\b[A-Za-z0-9._%+-]+\@[A-Za-z0-9._%+-]+\.[A-Za-z]+\b/),a&&(t=a[0],e=e.substring(0,a.index)+e.substring(a.index+a[0].length))),a=e.match(/<a href="tel:([^"]+)"/),a?l=m(a[1]):(a=e.match(/(?:^| )\+?\d(?: ?\d){9,12}\b/),a&&(l=m(a[0]),e=e.substring(0,a.index)+e.substring(a.index+a[0].length))),{text:e.replace(/<a[^>]*>[^>]*<\/a>/g,"").replace(/  +/g," ").trim(),email:t,tel:l}}function h(e){const{text:l,email:a,tel:n}=d(e);let r=null,s=null;const o=l.indexOf(":");return-1===o?r=l:(r=l.substring(0,o).trim(),s=l.substring(o+1).trim()),(0,t.createBlock)("semla/contact",{role:r,name:s,email:a,tel:n})}function x({name:e,email:t,tel:l}){let a=e?.trim()||"";return t&&(a&&(a+="<br>"),a+=`<a href="mailto:${t=t.trim()}">${t}</a>`),l&&(a&&(a+="<br>"),a+=`<a href="tel:${l.replaceAll(" ","")}">${l}</a>`),a}function b({attributes:e}){const{role:t,name:l,email:a,tel:n}=e,s={"pointer-events":"none"};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"avf-name",children:t}),(0,r.jsxs)("div",{className:"avf-value",children:[l,a&&l&&(0,r.jsx)("br",{}),a&&(0,r.jsx)("a",{style:s,href:`mailto:${a}`,children:a}),n&&(l||a)&&(0,r.jsx)("br",{}),n&&(0,r.jsx)("a",{style:s,href:`tel:${n.replaceAll(" ","")}`,children:n})]})]})}function p({attributes:e,exclude:t,setAttributes:a,onChange:n}){const{role:s,name:o,email:i,tel:c}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.TextControl,{label:"Role",value:s,onChange:e=>n("role",e)}),(0,r.jsx)(l.TextControl,{label:"Name",value:o,onChange:e=>n("name",e)}),(0,r.jsx)(l.TextControl,{label:"Email",type:"email",value:i,onChange:e=>n("email",e)}),(0,r.jsx)(l.TextControl,{label:"Telephone",type:"tel",value:c,onChange:e=>n("tel",e)}),(0,r.jsx)(l.ToggleControl,{label:"Exclude from mailing lists",checked:t,onChange:e=>a({exclude:e})})]})}(0,t.registerBlockType)(i.UU,{icon:c,edit:function({attributes:t,setAttributes:n,isSelected:i}){const{exclude:u,sameLine:d}=t,h=(0,e.useBlockProps)({className:d?"avf-same-line":""}),x=!t.role||!t.email&&!t.tel,[g,v]=(0,a.useState)(x);x&&!g&&v(!0);const[w,f]=(0,a.useState)({...t}),j=function(e,t){f({...w,[e]:t}),t=""+t,t="tel"===e?m(t):"email"===e?t.replaceAll(" ",""):t.trim().replace(/  +/g," "),n({[e]:t})};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.BlockControls,{children:(0,r.jsxs)(l.ToolbarGroup,{children:[i&&!x&&(0,r.jsx)(l.ToolbarButton,{label:"Edit mode",icon:s,isActive:g,onClick:()=>v(e=>!e)}),(0,r.jsx)(l.ToolbarButton,{icon:o,label:"Put contact details on line below role",isActive:!d,onClick:()=>n({sameLine:!d})})]})}),i&&(0,r.jsx)(e.InspectorControls,{children:(0,r.jsx)(l.PanelBody,{title:"Settings",initialOpen:!0,children:(0,r.jsx)(p,{attributes:w,exclude:u,setAttributes:n,onChange:j})})}),(0,r.jsx)("div",{...h,children:x||g&&i?(0,r.jsx)(l.Placeholder,{icon:c,label:"Contact",isColumnLayout:!0,children:(0,r.jsx)(p,{attributes:w,exclude:u,setAttributes:n,onChange:j})}):(0,r.jsx)(b,{attributes:t})})]})},transforms:u})})();