!function(){"use strict";var o="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),d="January_February_March_April_May_June_July_August_September_October_November_December".split("_");function l(t){return 1===parseInt(t%100/10,10)?"th":1==(t=t%10)?"st":2==t?"nd":3==t?"rd":"th"}function c(t){var e,a=parseInt(t.substring(11,13),10),t=t.substring(14,16),a=(11<a?(e="pm",12<a&&(a-=12)):e="am",""+a);return"00"!==t&&(a+=":"+t),{time:a,ampm:e}}function u(t,e){var a=new Date(e),n=parseInt(e.substring(8,10),10),a=o[a.getDay()]+" "+n+l(n),n=e.substring(5,7),n=(n!==t.substring(5,7)&&(a+=" "+d[parseInt(n,10)-1]),e.substring(0,4));return n!==t.substring(0,4)&&(a+=" "+n),a}function e(t){var e=document.getElementById("semla_cal");e?e.innerHTML=t:console.log("Error: no div with id semla_cal")}gapi.load("client",function(){gapi.client.init({apiKey:window.semla.gapi,discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"]}).then(function(){return gapi.client.calendar.events.list({calendarId:window.semla.cid,timeZone:"Europe/London",singleEvents:!0,timeMin:(new Date).toISOString(),orderBy:"startTime",fields:"items(summary,start,end"+(window.semla.calEnhanced?",description,location":"")+")"})}).then(function(t){var r,m;t.result.items&&(r=['<dl class="calendar">'],m="",t.result.items.forEach(function(t){var e,a=t.start.date||t.start.dateTime.substring(0,10),n=a.substring(0,8),n=(n!==m&&(r.push("<dt>"+d[parseInt(n.substring(5,7),10)-1]+" "+n.substring(0,4)+"</dt>"),m=n),parseInt(a.substring(8,10),10)),s=new Date(a),s=o[s.getDay()]+" "+n+l(n),i=(t.start.dateTime?(s+=", ",n=c(t.start.dateTime),i=c(t.end.dateTime),a===(e=t.end.dateTime.substring(0,10))?(n.ampm===i.ampm&&(n.ampm=""),s+=n.time+n.ampm+"-"+i.time+i.ampm):s+=n.time+n.ampm+" - "+u(a,e)+", "+i.time+i.ampm):((n=new Date(t.end.date)).setDate(n.getDate()-1),(e=n.toISOString().split("T")[0])!==a&&(s+=" - "+u(a,e))),t.summary),n="";window.semla.calEnhanced&&1<(a=i.split(":")).length&&(i=a[0].trim(),n=' <mark class="tag',e=a[1].trim(),window.semla.calTags&&window.semla.calTags[e]&&(n+=" semla__tag"+window.semla.calTags[e]),n+='">'+e+"</mark>"),t.description?(e=!!(a=(a=t.description).match(/(\b(https?):\/\/[-A-Z0-9+&@#/%?=~_|!:,.;]*[-A-Z0-9+&@#/%=~_|])/i))&&a[0])&&(i='<a href="'+e+'">'+i+"</a>"):i="<b>"+i+"</b>",s+=" - "+i,t.location&&(s+=" "+t.location),r.push("<dd>"+(s+=n)+"</dd>")}),r.push("</dl>"),e(r.join("")))},function(t){e("<p>Error: "+t.result.error.message+"</p>")})})}();