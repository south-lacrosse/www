(()=>{"use strict";const e=window.wp.blockEditor,t=window.wp.blocks,l=window.wp.components,n=window.wp.element,a=window.wp.primitives,r=window.ReactJSXRuntime,o=(0,r.jsx)(a.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,r.jsx)(a.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})}),s=(0,r.jsx)(a.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,r.jsx)(a.Path,{d:"M4 7.2v1.5h16V7.2H4zm8 8.6h8v-1.5h-8v1.5zm-8-3.5l3 3-3 3 1 1 4-4-4-4-1 1z"})}),i=JSON.parse('{"u2":"semla/contact"}');function c(e){return(e=e.trim()).includes(" ")?e.replace(/  +/g," "):e.replace(/^\+44(\d{4})(\d{6})$/,"+44 $1 $2").replace(/^07(\d{3})(\d{6})$/,"07$1 $2")}const m={from:[{type:"raw",isMatch:e=>{var t,l;if("P"!==e.nodeName)return!1;const n=e.innerHTML.replaceAll("<br>"," ").replace(/<a[^>]*href="(mailto|tel)[^>]*>/g,"").replaceAll("</a>","");if(n.includes("<"))return!1;const a=n.split(":");if(2!==a.length)return!1;const r=a[1],o=null!==(t=r.match(/\b[A-Za-z0-9._%+-]+\@[A-Za-z0-9._%+-]+\.[A-Za-z]+\b/g)?.length)&&void 0!==t?t:0;if(o>1)return!1;const s=null!==(l=r.match(/\b\+?\d(?: ?\d){9,12}\b/g)?.length)&&void 0!==l?l:0;return s<2&&(o>0||s>0)},transform:e=>h(e.innerHTML)},{type:"block",isMultiBlock:!0,blocks:["core/paragraph"],transform:e=>e.map((({content:e})=>h(e)))},{type:"block",isMultiBlock:!0,blocks:["semla/attr-value"],transform:e=>e.map((({attr:e,value:l,sameLine:n})=>{const{text:a,email:r,tel:o}=u(l);return(0,t.createBlock)("semla/contact",{role:e,name:a,email:r,tel:o,sameLine:n})}))}],to:[{type:"block",isMultiBlock:!0,blocks:["core/paragraph"],transform:e=>e.map((e=>(0,t.createBlock)("core/paragraph",{content:`${e.role}: `+d(e)})))},{type:"block",isMultiBlock:!0,blocks:["semla/attr-value"],transform:e=>e.map((e=>(0,t.createBlock)("semla/attr-value",{attr:e.role,value:d(e),sameLine:e.sameLine})))}]};function u(e){let t="",l="",n=(e=e.replace(/<br[^>]*>/g," ").replace(/<(?!a |\/a>)[^>]*>/g,"").replaceAll("&nbsp;"," ")).match(/<a href="mailto:([^"]+)"/);return n?t=n[1].trim():(n=e.match(/\b[A-Za-z0-9._%+-]+\@[A-Za-z0-9._%+-]+\.[A-Za-z]+\b/),n&&(t=n[0],e=e.substring(0,n.index)+e.substring(n.index+n[0].length))),n=e.match(/<a href="tel:([^"]+)"/),n?l=c(n[1]):(n=e.match(/(?:^| )\+?\d(?: ?\d){9,12}\b/),n&&(l=c(n[0]),e=e.substring(0,n.index)+e.substring(n.index+n[0].length))),{text:e.replace(/<a[^>]*>[^>]*<\/a>/g,"").replace(/  +/g," ").trim(),email:t,tel:l}}function h(e){const{text:l,email:n,tel:a}=u(e);let r=null,o=null;const s=l.indexOf(":");return-1===s?r=l:(r=l.substring(0,s).trim(),o=l.substring(s+1).trim()),(0,t.createBlock)("semla/contact",{role:r,name:o,email:n,tel:a})}function d({name:e,email:t,tel:l}){let n=e?.trim()||"";return t&&(n&&(n+="<br>"),n+=`<a href="mailto:${t=t.trim()}">${t}</a>`),l&&(n&&(n+="<br>"),n+=`<a href="tel:${l.replaceAll(" ","")}">${l}</a>`),n}function p({attributes:e}){const{role:t,name:l,email:n,tel:a}=e,o={"pointer-events":"none"};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"avf-name",children:t}),(0,r.jsxs)("div",{className:"avf-value",children:[l,n&&l&&(0,r.jsx)("br",{}),n&&(0,r.jsx)("a",{style:o,href:`mailto:${n}`,children:n}),a&&(l||n)&&(0,r.jsx)("br",{}),a&&(0,r.jsx)("a",{style:o,href:`tel:${a.replaceAll(" ","")}`,children:a})]})]})}function b({attributes:e,onChange:t}){const{role:n,name:a,email:o,tel:s}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.TextControl,{label:"Role",value:n,onChange:e=>t({role:e})}),(0,r.jsx)(l.TextControl,{label:"Name",value:a,onChange:e=>t({name:e})}),(0,r.jsx)(l.TextControl,{label:"Email",type:"email",value:o,onChange:e=>t({email:e})}),(0,r.jsx)(l.TextControl,{label:"Telephone",type:"tel",value:s,onChange:e=>t({tel:e})})]})}(0,t.registerBlockType)(i.u2,{edit:function({attributes:t,setAttributes:a,isSelected:i}){const{sameLine:m}=t,u=(0,e.useBlockProps)({className:m?"avf-same-line":""}),h=!t.role||!t.email&&!t.tel,[d,x]=(0,n.useState)(h);h&&!d&&x(!0);const[g,f]=(0,n.useState)({...t}),v=function(e){f({...g,...e});const t={};for(const l in e){const n=""+e[l];t[l]="tel"===l?c(n):"email"===l?n.replaceAll(" ",""):n.trim().replace(/  +/g," ")}a(t)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.BlockControls,{children:(0,r.jsxs)(l.ToolbarGroup,{children:[i&&!h&&(0,r.jsx)(l.ToolbarButton,{label:"Edit mode",icon:o,isActive:d,onClick:()=>x((e=>!e))}),(0,r.jsx)(l.ToolbarButton,{icon:s,label:"Put contact details on line below role",isActive:!m,onClick:()=>a({sameLine:!m})})]})}),i&&(0,r.jsx)(e.InspectorControls,{children:(0,r.jsx)(l.PanelBody,{title:"Settings",initialOpen:!0,children:(0,r.jsx)(b,{attributes:g,onChange:v})})}),(0,r.jsx)("div",{...u,children:h||d&&i?(0,r.jsx)(l.Placeholder,{icon:"admin-users",label:"Contact",isColumnLayout:!0,children:(0,r.jsx)(b,{attributes:g,onChange:v})}):(0,r.jsx)(p,{attributes:t})})]})},transforms:m})})();