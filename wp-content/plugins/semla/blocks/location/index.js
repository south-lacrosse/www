(()=>{"use strict";const e=window.wp.element,t=window.wp.blocks,a=window.wp.blockEditor,n=window.wp.components,l=JSON.parse('{"u2":"semla/location"}');(0,t.registerBlockType)(l.u2,{edit:function(t){let{attributes:l,setAttributes:o,isSelected:c}=t;const{address:d,notes:m,lat:p,long:u,latLong:h}=l,[w,g]=(0,e.useState)(!1);return(0,e.createElement)("div",(0,a.useBlockProps)(),(0,e.createElement)(a.BlockControls,null,(0,e.createElement)(n.ToolbarGroup,null,(0,e.createElement)(n.ToolbarButton,{icon:(0,e.createElement)(n.Icon,{icon:"location-alt"}),label:"Set location on map",onClick:()=>{window.semla=window.semla||{},window.semla.loc={address:d,lat:p,long:u},g(!0)}}))),(0,e.createElement)(a.InspectorControls,null,(0,e.createElement)(n.PanelBody,{title:"Help",initialOpen:!1},(0,e.createElement)("p",null,"To display the map either enter the coordinates below, or find the exact location on a map using the button in the toolbar (the map will start at the current location, or if none is set then it will start at the address if entered)."),(0,e.createElement)("p",null,"Put important instructions that should always be displayed in the entry field above the map (e.g. non-grass pitch types and required footwear, non-standard start times), as anything below that will be hidden when the page is initially displayed."),(0,e.createElement)("p",null,"Enter directions below the map. Since 99.9% of people have SatNav on their phones only add anything if the route is complicated, or things like the postcode taking people to the wrong place. And if possible add information about public transport.")),(0,e.createElement)(n.PanelBody,{title:"Map"},(0,e.createElement)("p",null,'If you know the exact coordinates enter them below, and click the "Update Map" button to update the map.'),(0,e.createElement)(n.TextControl,{label:"Latitude",type:"number",value:p,min:50,max:54,onChange:e=>o({lat:parseFloat(e)})}),(0,e.createElement)(n.TextControl,{label:"Longitude",type:"number",value:u,min:-6,max:2,onChange:e=>o({long:parseFloat(e)})}),(0,e.createElement)(n.Button,{variant:"secondary",onClick:()=>{o({latLong:i(p,u)})}},"Update Map"))),w&&(0,e.createElement)(n.Modal,{onRequestClose:()=>g(!1),title:"Set Location on Map",className:"semla-map-modal",shouldCloseOnClickOutside:!1},(0,e.createElement)("p",null,"Drag the marker or double-click to set the exact position. You can also use the search box to search for a location."),(0,e.createElement)("iframe",{title:"Map",id:"semla-map-iframe",src:r()+"../../modal/map-dialog.html"}),(0,e.createElement)(n.ButtonGroup,{className:"semla-map-buttons"},(0,e.createElement)(n.Button,{variant:"primary",onClick:()=>{o({lat:window.semla.loc.lat,long:window.semla.loc.long,latLong:i(window.semla.loc.lat,window.semla.loc.long)}),g(!1)}},"OK"),(0,e.createElement)(n.Button,{variant:"secondary",onClick:()=>g(!1)},"Cancel"))),(0,e.createElement)(a.PlainText,{label:"Address",value:d,placeholder:"Address",onChange:e=>{o({address:e})}}),(!s(m)||c)&&(0,e.createElement)(a.RichText,{label:"Notes",value:m,multiline:!0,placeholder:"Important notes, including pitch type if non-grass...",onChange:e=>o({notes:e})}),(0,e.createElement)("div",{className:"semla__border semla__border_dashed"},(0,e.createElement)("button",{className:"acrd-btn"},"Map and Directions (will start hidden on live page)"),h&&(0,e.createElement)("iframe",{className:"gmap",src:"https://www.google.com/maps/embed/v1/place?q="+h+"&zoom=15&key="+window.semla.gapi,title:"Google Map",allowFullScreen:!0}),(0,e.createElement)(a.InnerBlocks,{allowedBlocks:["core/image","core/paragraph"]})))},save:function(t){let{attributes:n}=t;const{notes:l,latLong:o}=n;return(0,e.createElement)("div",a.useBlockProps.save(),(0,e.createElement)("p",null,n.address),!s(l)&&(0,e.createElement)(a.RichText.Content,{tagName:"div",className:"location__notes",value:l,multiline:!0}),(0,e.createElement)("button",{className:"acrd-btn","data-toggle":"collapse","aria-expanded":"false"},"Map and Directions"),(0,e.createElement)("div",{className:"acrd-content"},o&&(0,e.createElement)(e.RawHTML,null,"!MAP!"),!o&&(0,e.createElement)("p",null,"Map coordinates not set!"),(0,e.createElement)(a.InnerBlocks.Content,null)))}});let o=null;function r(){if(null===o){const e=document.currentScript||document.querySelector('script[src*="semla/blocks/"]');if(e){const t=e.src;o=t.substring(0,t.lastIndexOf("/")+1)}}return o}function s(e){return!e||0===e.length||"<p></p>"===e}function i(e,t){return isNaN(e)||isNaN(t)||e<50||e>54||t<-6||t>2?null:e.toFixed(6)+"%2C"+t.toFixed(6)}})();