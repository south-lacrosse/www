(()=>{"use strict";const e=window.wp.blocks,t=window.wp.blockEditor,n=window.wp.components,c=window.wp.data,i=window.wp.element,o=window.ReactJSXRuntime;function l(e){return(0,o.jsx)(i.RawHTML,{children:'<ul id="semla_toc-list">'+e+"</ul>"})}function r(e,t){"core/heading"!==e.name?e.innerBlocks.forEach((e=>{r(e,t)})):function(e,t){const n=e.attributes;if(!n.content||!n.content.text)return;n.anchor&&!n.anchor.startsWith("st-")||(n.anchor="st-"+n.content.text.replace(/ +/g,"-").replace(/[^\w\s-]/g,""));const c={level:n.level,content:n.content.text,anchor:n.anchor};if(0!==t.length)for(;;){const e=t[t.length-1];if(c.level<=e.level)return void t.push(c);if(!e.children)return void(e.children=[c]);t=e.children}else t.push(c)}(e,t)}function s(e){let t="";return e.forEach((e=>{t+=`<li><a href="#${e.anchor}">${e.content}</a>`,e.children&&(t+="<ul>"+s(e.children)+"</ul>"),t+="</li>"})),t}(0,e.registerBlockType)("semla/toc",{edit:function({attributes:e,setAttributes:h,isSelected:a}){const{title:d,toc:u}=e,f=(0,c.useSelect)((e=>{const n=e(t.store).getBlocks(),c=[];return n.forEach((e=>{r(e,c)})),0===c.length?"":s(c)}),[]);return(0,i.useEffect)((()=>{f!==u&&h({toc:f})}),[f]),(0,o.jsxs)("div",{...(0,t.useBlockProps)(),children:[(0,o.jsx)(t.InspectorControls,{children:(0,o.jsx)(n.PanelBody,{title:"Help",initialOpen:!0,children:(0,o.jsx)("p",{children:"Set the HTML anchor of the headings to change the name of the internal links (you can find this in the Settings for the header blocks under Advanced)."})})}),(0,o.jsx)("div",{id:"semla_toc",children:(0,o.jsxs)("nav",{id:"semla_toc-nav",children:[a&&(0,o.jsx)(n.TextControl,{placeholder:"Title",onChange:e=>h({title:e}),value:d,keepPlaceholderOnFocus:!0}),!a&&d&&(0,o.jsx)("h4",{children:d}),(0,o.jsx)(n.Disabled,{children:l(u)})]})})]})},save:function({attributes:e}){const{title:n,toc:c}=e;return(0,o.jsx)("div",{id:"semla_toc",...t.useBlockProps.save(),children:(0,o.jsxs)("nav",{id:"semla_toc-nav",children:[n.trim().length>0&&(0,o.jsx)("h4",{children:n.trim()}),l(c)]})})}})})();