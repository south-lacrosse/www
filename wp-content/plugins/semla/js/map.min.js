!function(){"use strict";var r,m,i,g,d,c,u,p=null,n=null,h=null,f=null,a=-1,t=9,y=!0,L=document,v=window,o={UNKNOWN_ERROR:"The request could not be successfully processed, yet the exact reason for the failure is not known",OVER_QUERY_LIMIT:"The webpage has gone over the requests limit in too short a time",REQUEST_DENIED:"The webpage is not allowed to use the geocoder for some reason",INVALID_REQUEST:"This request was invalid",ZERO_RESULTS:"The address is unknown, please try another",ERROR:"There was a problem contacting the Google servers"};function E(){M(this.semlaClub)}function T(){m.getElementsByTagName("li")[this.semlaClub.order].className+=" hover"}function C(){var e=m.getElementsByTagName("li")[this.semlaClub.order];e.className=e.className.replace(" hover","")}function b(e,t){t===google.maps.GeocoderStatus.OK?S(e[0].geometry.location):alert(o[t])}function N(e){c.getZoom()<t?(c.setZoom(t),c.setCenter(e)):c.panTo(e)}function w(){for(var e=c.mapTypes.get(c.getMapTypeId()).maxZoom||21,t=c.mapTypes.get(c.getMapTypeId()).minZoom||0,n=c.getProjection().fromLatLngToPoint(u.getNorthEast()),a=c.getProjection().fromLatLngToPoint(u.getSouthWest()),o=Math.abs(n.x-a.x),s=Math.abs(n.y-a.y),l=e;t<=l&&!(o*(1<<l)+80<r.firstChild.offsetWidth&&s*(1<<l)+80<r.firstChild.offsetHeight);--l);c.setCenter(u.getCenter()),c.setZoom(l)}function M(e){n||(n=new google.maps.InfoWindow).addListener("closeclick",s);var t='<div style="margin: 0.1em"><b>'+e.name+"</b>";y||(t+="<br>("+e.dist+" miles from search)"),t+="<br><br>"+e.html+' <a style="padding-left:20px" href="https://www.google.co.uk/maps/dir//'+e.latLng.toUrlValue()+"/@"+e.latLng.toUrlValue()+',16z">directions</a></div>',n.setContent(t),-1!==a&&(m.getElementsByTagName("li")[a].className=""),a=e.order,m.getElementsByTagName("li")[a].className="selected",n.open(c,e.marker)}function I(){n&&(n.close(),s())}function s(){-1!==a&&(m.getElementsByTagName("li")[a].className="",a=-1)}function k(){var e=(v.innerHeight||L.documentElement.clientHeight||L.body.clientHeight)-B(r)-i.offsetHeight-d,e=Math.max(300,e),e=Math.round(e)+"px";r.style.height=e,m.style.height=e,c&&google.maps.event.trigger(c,"resize")}function B(e){for(var t=0;e;)t+=e.offsetTop,e=e.offsetParent;return t}function S(e){N(e);for(var t=SemlaClubs.length,n=P(e.lat()),a=Math.sin(n),o=Math.cos(n),s=t;s--;){var l,r=P((l=SemlaClubs[s]).lat);l.dist=3959*Math.acos(a*Math.sin(r)+o*Math.cos(r)*Math.cos(P(e.lng()-l.lng)))}SemlaClubs.sort(R),y=!1,I();var i=m.getElementsByTagName("li");for(s=t;s--;)(l=SemlaClubs[s]).order=s,l.marker.setLabel(""+(s+1)),l.dist=l.dist.toFixed(2),i[s].firstChild.nodeValue=s+1+". "+l.name+" "+l.dist+" mi"}function R(e,t){return e.dist-t.dist}function l(e,t){return e.name<t.name?-1:e.name>t.name?1:0}function O(){if(!y){SemlaClubs.sort(l),y=!0,I();for(var e=m.getElementsByTagName("li"),t=SemlaClubs.length;t--;){var n=SemlaClubs[t];n.order=t,n.marker.setLabel(""),e[t].firstChild.nodeValue=n.name}}}function P(e){return e*Math.PI/180}window.addEventListener("load",function(){r=L.getElementById("map"),m=L.getElementById("map-key"),i=L.getElementById("page-footer"),d=B(i)-B(r)-r.clientHeight,k(),v.addEventListener("resize",k,!1),L.getElementById("toggle-key").addEventListener("click",function(e){e.preventDefault(),-1<(p=p||L.getElementById("map-container")).className.indexOf("hide-key")?(p.className=p.className.replace(" hide-key",""),this.innerHTML="Hide Key"):(p.className+=" hide-key",this.innerHTML="Show Key"),c&&google.maps.event.trigger(c,"resize")},!1);var e=SemlaClubs.length;for(u=new google.maps.LatLngBounds,n=e;n--;)(a=SemlaClubs[n]).latLng=new google.maps.LatLng(a.lat,a.lng),u.extend(a.latLng);(c=new google.maps.Map(r,{center:u.getCenter(),fullscreenControl:!0,scaleControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:6})).fitBounds(u),c.addListener("resize",function(){h=this.getCenter()}),c.addListener("bounds_changed",function(){h&&this.setCenter(h),h=null});for(var t="",n=0;n<e;n++){var a=SemlaClubs[n],o=new google.maps.Marker({map:c,title:a.name,optimized:!1,position:a.latLng,semlaClub:a});a.marker=o,a.order=n,o.addListener("click",E),o.addListener("mouseover",T),o.addListener("mouseout",C),t+="<li>"+a.name+"</li>"}var s=L.getElementById("clubs-list");s.innerHTML=t,s.addEventListener("click",function(e){e=function(e){for(var t=e.parentNode.childNodes,n=0,a=0,o=t.length;a<o;a++){if(t[a]===e)return n;1===t[a].nodeType&&n++}return-1}(e.target),e=SemlaClubs[e];N(e.latLng),M(e)},!1);(s=L.createElement("div")).className="gmnoprint";var l=L.createElement("div");l.className="map-ctl",l.title="Click to recentre the map",l.innerHTML='<div class="map-ctl-text">Centre Map</div>',l.addEventListener("click",w),s.appendChild(l),c.controls[google.maps.ControlPosition.LEFT_TOP].push(s),c.controls[google.maps.ControlPosition.TOP_RIGHT].push(L.getElementById("search-wrapper")),g=L.getElementById("search-box"),new google.maps.places.Autocomplete(g,{bounds:new google.maps.LatLngBounds(new google.maps.LatLng(50,-6),new google.maps.LatLng(54,2)),componentRestrictions:{country:"gb"}}).addListener("place_changed",function(){var e=this.getPlace();if(!e.geometry)return""===e.name.trim()?void O():void(f=f||new google.maps.Geocoder).geocode({address:e.name.trim()},b);S(e.geometry.location)}),L.getElementById("search-reset").addEventListener("click",function(){g.value="",O()})})}();