(()=>{"use strict";const e=window.wp.blockEditor,t=window.wp.blocks,l=window.wp.components,a=window.wp.element,n=window.wp.primitives,r=window.ReactJSXRuntime,s=(0,r.jsx)(n.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,r.jsx)(n.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})}),o=(0,r.jsx)(n.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,r.jsx)(n.Path,{d:"M4 7.2v1.5h16V7.2H4zm8 8.6h8v-1.5h-8v1.5zm-8-3.5l3 3-3 3 1 1 4-4-4-4-1 1z"})}),i=JSON.parse('{"UU":"semla/contact"}');function c(e){return(e=e.trim()).includes(" ")?e.replace(/  +/g," "):e.replace(/^\+44(\d{4})(\d{6})$/,"+44 $1 $2").replace(/^07(\d{3})(\d{6})$/,"07$1 $2")}const m={from:[{type:"raw",isMatch:e=>{var t,l;if("P"!==e.nodeName)return!1;const a=e.innerHTML.replaceAll("<br>"," ").replace(/<a[^>]*href="(mailto|tel)[^>]*>/g,"").replaceAll("</a>","");if(a.includes("<"))return!1;const n=a.split(":");if(2!==n.length)return!1;const r=n[1],s=null!==(t=r.match(/\b[A-Za-z0-9._%+-]+\@[A-Za-z0-9._%+-]+\.[A-Za-z]+\b/g)?.length)&&void 0!==t?t:0;if(s>1)return!1;const o=null!==(l=r.match(/\b\+?\d(?: ?\d){9,12}\b/g)?.length)&&void 0!==l?l:0;return o<2&&(s>0||o>0)},transform:e=>d(e.innerHTML)},{type:"block",isMultiBlock:!0,blocks:["core/paragraph"],transform:e=>e.map((({content:e})=>d(e)))},{type:"block",isMultiBlock:!0,blocks:["semla/attr-value"],transform:e=>e.map((({attr:e,value:l,sameLine:a})=>{const{text:n,email:r,tel:s}=u(l);return(0,t.createBlock)("semla/contact",{role:e,name:n,email:r,tel:s,sameLine:a})}))}],to:[{type:"block",isMultiBlock:!0,blocks:["core/paragraph"],transform:e=>e.map((e=>(0,t.createBlock)("core/paragraph",{content:`${e.role}: `+h(e)})))},{type:"block",isMultiBlock:!0,blocks:["semla/attr-value"],transform:e=>e.map((e=>(0,t.createBlock)("semla/attr-value",{attr:e.role,value:h(e),sameLine:e.sameLine})))}]};function u(e){let t="",l="",a=(e=e.replace(/<br[^>]*>/g," ").replace(/<(?!a |\/a>)[^>]*>/g,"").replaceAll("&nbsp;"," ")).match(/<a href="mailto:([^"]+)"/);return a?t=a[1].trim():(a=e.match(/\b[A-Za-z0-9._%+-]+\@[A-Za-z0-9._%+-]+\.[A-Za-z]+\b/),a&&(t=a[0],e=e.substring(0,a.index)+e.substring(a.index+a[0].length))),a=e.match(/<a href="tel:([^"]+)"/),a?l=c(a[1]):(a=e.match(/(?:^| )\+?\d(?: ?\d){9,12}\b/),a&&(l=c(a[0]),e=e.substring(0,a.index)+e.substring(a.index+a[0].length))),{text:e.replace(/<a[^>]*>[^>]*<\/a>/g,"").replace(/  +/g," ").trim(),email:t,tel:l}}function d(e){const{text:l,email:a,tel:n}=u(e);let r=null,s=null;const o=l.indexOf(":");return-1===o?r=l:(r=l.substring(0,o).trim(),s=l.substring(o+1).trim()),(0,t.createBlock)("semla/contact",{role:r,name:s,email:a,tel:n})}function h({name:e,email:t,tel:l}){let a=e?.trim()||"";return t&&(a&&(a+="<br>"),a+=`<a href="mailto:${t=t.trim()}">${t}</a>`),l&&(a&&(a+="<br>"),a+=`<a href="tel:${l.replaceAll(" ","")}">${l}</a>`),a}function b({attributes:e}){const{role:t,name:l,email:a,tel:n}=e,s={"pointer-events":"none"};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"avf-name",children:t}),(0,r.jsxs)("div",{className:"avf-value",children:[l,a&&l&&(0,r.jsx)("br",{}),a&&(0,r.jsx)("a",{style:s,href:`mailto:${a}`,children:a}),n&&(l||a)&&(0,r.jsx)("br",{}),n&&(0,r.jsx)("a",{style:s,href:`tel:${n.replaceAll(" ","")}`,children:n})]})]})}function p({attributes:e,exclude:t,setAttributes:a,onChange:n}){const{role:s,name:o,email:i,tel:c}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.TextControl,{label:"Role",value:s,onChange:e=>n("role",e)}),(0,r.jsx)(l.TextControl,{label:"Name",value:o,onChange:e=>n("name",e)}),(0,r.jsx)(l.TextControl,{label:"Email",type:"email",value:i,onChange:e=>n("email",e)}),(0,r.jsx)(l.TextControl,{label:"Telephone",type:"tel",value:c,onChange:e=>n("tel",e)}),(0,r.jsx)(l.ToggleControl,{label:"Exclude from mailing lists",checked:t,onChange:e=>a({exclude:e})})]})}(0,t.registerBlockType)(i.UU,{edit:function({attributes:t,setAttributes:n,isSelected:i}){const{exclude:m,sameLine:u}=t,d=(0,e.useBlockProps)({className:u?"avf-same-line":""}),h=!t.role||!t.email&&!t.tel,[x,g]=(0,a.useState)(h);h&&!x&&g(!0);const[f,v]=(0,a.useState)({...t}),j=function(e,t){v({...f,[e]:t}),t=""+t,t="tel"===e?c(t):"email"===e?t.replaceAll(" ",""):t.trim().replace(/  +/g," "),n({[e]:t})};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.BlockControls,{children:(0,r.jsxs)(l.ToolbarGroup,{children:[i&&!h&&(0,r.jsx)(l.ToolbarButton,{label:"Edit mode",icon:s,isActive:x,onClick:()=>g((e=>!e))}),(0,r.jsx)(l.ToolbarButton,{icon:o,label:"Put contact details on line below role",isActive:!u,onClick:()=>n({sameLine:!u})})]})}),i&&(0,r.jsx)(e.InspectorControls,{children:(0,r.jsx)(l.PanelBody,{title:"Settings",initialOpen:!0,children:(0,r.jsx)(p,{attributes:f,exclude:m,setAttributes:n,onChange:j})})}),(0,r.jsx)("div",{...d,children:h||x&&i?(0,r.jsx)(l.Placeholder,{icon:"admin-users",label:"Contact",isColumnLayout:!0,children:(0,r.jsx)(p,{attributes:f,exclude:m,setAttributes:n,onChange:j})}):(0,r.jsx)(b,{attributes:t})})]})},transforms:m})})();