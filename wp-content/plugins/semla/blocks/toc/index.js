(()=>{"use strict";const e=window.wp.blocks,t=window.wp.blockEditor,n=window.wp.components,c=window.wp.data,o=window.wp.element,i=window.ReactJSXRuntime;function l(e){return(0,i.jsx)(o.RawHTML,{children:'<ul id="semla_toc-list">'+e+"</ul>"})}function r(e,t){"core/heading"!==e.name?e.innerBlocks.forEach((e=>{r(e,t)})):function(e,t){const n=e.attributes;if(!n.content||!n.content.text)return;const c=n.content.toString().replace(/<[^>]+>/g,"").replace(/  +/g," ");n.anchor&&!n.anchor.startsWith("st-")||(n.anchor="st-"+n.content.text.replace(/[^\w\s-]/g,"").replace(/ +/g,"-"));const o={level:n.level,content:c,anchor:n.anchor};if(0!==t.length)for(;;){const e=t[t.length-1];if(o.level<=e.level)return void t.push(o);if(!e.children)return void(e.children=[o]);t=e.children}else t.push(o)}(e,t)}function s(e){let t="";return e.forEach((e=>{t+=`<li><a href="#${e.anchor}">${e.content}</a>`,e.children&&(t+="<ul>"+s(e.children)+"</ul>"),t+="</li>"})),t}(0,e.registerBlockType)("semla/toc",{edit:function({attributes:e,setAttributes:a,isSelected:h}){const{title:d,toc:u}=e,f=(0,c.useSelect)((e=>{const n=e(t.store).getBlocks(),c=[];return n.forEach((e=>{r(e,c)})),0===c.length?"":s(c)}),[]);return(0,o.useEffect)((()=>{f!==u&&a({toc:f})}),[f]),(0,i.jsxs)("div",{...(0,t.useBlockProps)(),children:[(0,i.jsx)(t.InspectorControls,{children:(0,i.jsx)(n.PanelBody,{title:"Help",initialOpen:!0,children:(0,i.jsx)("p",{children:"Set the HTML anchor of the headings to change the name of the internal links (you can find this in the Settings for the header blocks under Advanced)."})})}),(0,i.jsx)("div",{id:"semla_toc",children:(0,i.jsxs)("nav",{id:"semla_toc-nav",children:[h&&(0,i.jsx)(n.TextControl,{placeholder:"Title",onChange:e=>a({title:e}),value:d,keepPlaceholderOnFocus:!0}),!h&&d&&(0,i.jsx)("h4",{children:d}),(0,i.jsx)(n.Disabled,{children:l(u)})]})})]})},save:function({attributes:e}){const{title:n,toc:c}=e;return(0,i.jsx)("div",{id:"semla_toc",...t.useBlockProps.save(),children:(0,i.jsxs)("nav",{id:"semla_toc-nav",children:[n.trim().length>0&&(0,i.jsx)("h4",{children:n.trim()}),l(c)]})})}})})();