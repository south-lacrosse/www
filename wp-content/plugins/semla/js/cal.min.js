!function(){var o="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),d="January_February_March_April_May_June_July_August_September_October_November_December".split("_");function e(){return gapi.client.calendar.events.list({calendarId:window.semla.cid,eventTypes:["default"],timeZone:"Europe/London",singleEvents:!0,timeMin:(new Date).toISOString(),orderBy:"startTime",fields:"items(summary,start,end"+(window.semla.calEnhanced?",description,location":"")+")"})}function t(e){var r,m,e=e.result.items;e&&0!==e.length?(r=['<dl class="calendar">'],m="",e.forEach(function(e){var t,n=e.start.date||e.start.dateTime.substring(0,10),a=n.substring(0,8),a=(a!==m&&(r.push("<dt>"+d[parseInt(a.substring(5,7),10)-1]+" "+a.substring(0,4)+"</dt>"),m=a),parseInt(n.substring(8,10),10)),i=new Date(n),i=o[i.getDay()]+" "+a+l(a),s=(e.start.dateTime?(i+=", ",a=c(e.start.dateTime),s=c(e.end.dateTime),n===(t=e.end.dateTime.substring(0,10))?(a.ampm===s.ampm&&(a.ampm=""),i+=a.time+a.ampm+"-"+s.time+s.ampm):i+=a.time+a.ampm+" - "+u(n,t)+", "+s.time+s.ampm):((a=new Date(e.end.date)).setTime(a.getTime()-864e5),(t=a.toISOString().split("T")[0])!==n&&(i+=" - "+u(n,t))),e.summary),a="";window.semla.calEnhanced&&1<(n=s.split(":")).length&&(s=n[0].trim(),a=' <mark class="tag',t=n[1].trim(),window.semla.calTags&&window.semla.calTags[t]&&(a+=" semla__tag"+window.semla.calTags[t]),a+='">'+t+"</mark>"),e.description?(n=function(e){e=e.match(/(\b(https?):\/\/[-A-Z0-9+&@#/%?=~_|!:,.;]*[-A-Z0-9+&@#/%=~_|])/i);return!!e&&e[0]}(e.description))&&(s='<a href="'+n+'">'+s+"</a>"):s="<b>"+s+"</b>",i+=" - "+s,e.location&&(i+=" "+e.location),r.push("<dd>"+(i+=a)+"</dd>")}),r.push("</dl>"),a(r.join(""))):a("<p>No pending events.</p>")}function n(e){console.log(e),a("<p>Error: "+e.result.error.message+"</p>")}function l(e){return 1===parseInt(e%100/10,10)?"th":1==(e=e%10)?"st":2==e?"nd":3==e?"rd":"th"}function c(e){var t,n=parseInt(e.substring(11,13),10),e=e.substring(14,16),n=(11<n?(t="pm",12<n&&(n-=12)):t="am",""+n);return"00"!==e&&(n+=":"+e),{time:n,ampm:t}}function u(e,t){var n=new Date(t),a=parseInt(t.substring(8,10),10),n=o[n.getDay()]+" "+a+l(a),a=t.substring(5,7),a=(a!==e.substring(5,7)&&(n+=" "+d[parseInt(a,10)-1]),t.substring(0,4));return a!==e.substring(0,4)&&(n+=" "+a),n}function a(e){var t=document.getElementById("semla_cal");t?t.innerHTML=e:console.log("Error: no div with id semla_cal")}gapi.load("client",function(){gapi.client.init({apiKey:window.semla.gapi,discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"]}).then(e).then(t,n)})}();