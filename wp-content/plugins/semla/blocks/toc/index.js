(()=>{"use strict";const e=window.wp.blocks,t=window.wp.blockEditor,n=window.wp.components,o=window.wp.data,i=window.wp.element,l=window.wp.primitives,r=window.ReactJSXRuntime,c=(0,r.jsx)(l.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,r.jsx)(l.Path,{d:"M19 5.5H5V4h14v1.5ZM19 20H5v-1.5h14V20ZM5 9h14v6H5V9Z"})}),s=(0,r.jsx)(l.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,r.jsx)(l.Path,{d:"M14 6v12h6V6h-6zM4 10h7V8.5H4V10zm0 5.5h7V14H4v1.5z"})});function h(e){return(0,r.jsx)(i.RawHTML,{children:'<ul id="semla_toc-list">'+e+"</ul>"})}function a(e,t){"core/heading"!==e.name?e.innerBlocks.forEach(e=>{a(e,t)}):e.attributes.anchor?function(e,t){const n=e.attributes;if(!n.content||!n.content.text)return;const o=n.content.toString().replace(/<[^>]+>/g,"").replace(/  +/g," "),i={level:n.level,content:o,anchor:n.anchor};if(0!==t.length)for(;;){const e=t[t.length-1];if(i.level<=e.level)return void t.push(i);if(!e.children)return void(e.children=[i]);t=e.children}else t.push(i)}(e,t.tree):t.headingsWithoutAnchor++}function d(e){let t="";return e.forEach(e=>{t+=`<li><a href="#${e.anchor}">${e.content}</a>`,e.children&&(t+="<ul>"+d(e.children)+"</ul>"),t+="</li>"}),t}(0,e.registerBlockType)("semla/toc",{edit:function({attributes:e,setAttributes:l,isSelected:u}){const{title:w,toc:g,floatRight:p}=e,[v,x]=(0,o.useSelect)(e=>{const n=e(t.store).getBlocks(),o={tree:[],headingsWithoutAnchor:!1};return n.forEach(e=>{a(e,o)}),[0===o.tree.length?"":d(o.tree),o.headingsWithoutAnchor]},[]);return(0,i.useEffect)(()=>{v!==g&&l({toc:v})},[v]),(0,r.jsxs)("div",{...(0,t.useBlockProps)(),children:[(0,r.jsx)(t.BlockControls,{children:(0,r.jsxs)(n.ToolbarGroup,{children:[(0,r.jsx)(n.ToolbarButton,{icon:c,label:"Full width",isActive:!p,onClick:()=>{l({floatRight:!1})}}),(0,r.jsx)(n.ToolbarButton,{icon:s,label:"Float right",isActive:p,onClick:()=>{l({floatRight:!0})}})]})}),(0,r.jsx)(t.InspectorControls,{children:(0,r.jsxs)(n.PanelBody,{title:"Help",initialOpen:!0,children:[(0,r.jsx)("p",{children:"Add heading blocks and set their HTML anchor to add to the table of contents (you can find this in the block Settings under Advanced). The anchor will become the name of the internal link. Open the Document Overview to see all the blocks and their anchors."}),(0,r.jsx)("p",{children:'If you select "Float right" (the default) the table of contents will float to the right on the live page if the window is wide enough. This can\'t be shown in the editor, so you need to open the preview to see.'})]})}),(0,r.jsx)("div",{id:"semla_toc",children:(0,r.jsxs)("nav",{id:"semla_toc-nav",children:[u&&(0,r.jsx)(n.TextControl,{placeholder:"Title",onChange:e=>l({title:e}),value:w,keepPlaceholderOnFocus:!0}),!u&&w&&(0,r.jsx)("h4",{children:w}),g?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.Disabled,{children:h(g)}),x&&(0,r.jsx)("p",{children:(0,r.jsxs)("i",{children:["There are ",x," ","headings without anchors which won't appear here."]})})]}):(0,r.jsx)("p",{children:"Start adding Heading blocks to create a table of contents. Headings with HTML anchors will be linked here."})]})})]})},save:function({attributes:e}){const{title:n,toc:o,floatRight:i}=e,l=t.useBlockProps.save({className:i?"":"semla_toc-floatnone"});return(0,r.jsx)("div",{id:"semla_toc",...l,children:(0,r.jsxs)("nav",{id:"semla_toc-nav",children:[n.trim().length>0&&(0,r.jsx)("h4",{children:n.trim()}),h(o)]})})}})})();