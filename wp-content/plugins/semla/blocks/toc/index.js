(()=>{"use strict";const e=window.wp.blocks,t=window.wp.blockEditor,n=window.wp.components,i=window.wp.data,c=window.wp.element,l=window.ReactJSXRuntime;function o(e){return(0,l.jsx)(c.RawHTML,{children:'<ul id="semla_toc-list">'+e+"</ul>"})}function r(e,t){"core/heading"!==e.name?e.innerBlocks.forEach((e=>{r(e,t)})):function(e,t){let n=e.attributes;if(n.content)if(n.anchor&&!n.anchor.startsWith("st-")||(n.anchor="st-"+n.content.toString().replace(/( |<br>)/g,"-").replace(/[^\w\s-]/g,"")),n={level:n.level,content:n.content,anchor:n.anchor},0!==t.length)for(;;){const e=t[t.length-1];if(n.level<=e.level)return void t.push(n);if(!e.children)return void(e.children=[n]);t=e.children}else t.push(n)}(e,t)}function s(e){let t="";return e.forEach((e=>{t+=`<li><a href="#${e.anchor}">${e.content}</a>`,e.children&&(t+="<ul>"+s(e.children)+"</ul>"),t+="</li>"})),t}(0,e.registerBlockType)("semla/toc",{edit:function({attributes:e,setAttributes:h,isSelected:a}){const{title:d,toc:u}=e,f=(0,i.useSelect)((e=>{const n=e(t.store).getBlocks(),i=[];return n.forEach((e=>{r(e,i)})),0===i.length?"":s(i)}),[]);return(0,c.useEffect)((()=>{f!==u&&h({toc:f})}),[f]),(0,l.jsxs)("div",{...(0,t.useBlockProps)(),children:[(0,l.jsx)(t.InspectorControls,{children:(0,l.jsx)(n.PanelBody,{title:"Help",initialOpen:!0,children:(0,l.jsx)("p",{children:"Set the HTML anchor of the headings to change the name of the internal links (you can find this in the Settings for the header blocks under Advanced)."})})}),(0,l.jsx)("div",{id:"semla_toc",children:(0,l.jsxs)("nav",{id:"semla_toc-nav",children:[a&&(0,l.jsx)(n.TextControl,{placeholder:"Title",onChange:e=>h({title:e}),value:d,keepPlaceholderOnFocus:!0}),!a&&d&&(0,l.jsx)("h4",{children:d}),(0,l.jsx)(n.Disabled,{children:o(u)})]})})]})},save:function({attributes:e}){const{title:n,toc:i}=e;return(0,l.jsx)("div",{id:"semla_toc",...t.useBlockProps.save(),children:(0,l.jsxs)("nav",{id:"semla_toc-nav",children:[n.trim().length>0&&(0,l.jsx)("h4",{children:n.trim()}),o(i)]})})}})})();