(()=>{"use strict";function e(){return e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(e[l]=n[l])}return e},e.apply(this,arguments)}const t=window.wp.element,n=window.wp.blocks,l=window.wp.blockEditor,r=window.wp.components,c=window.wp.data;function o(e){return(0,t.createElement)(t.RawHTML,null,'<ul id="semla_toc-list">'+e+"</ul>")}function i(e,t){"core/heading"!==e.name?e.innerBlocks.forEach((e=>{i(e,t)})):function(e,t){let n=e.attributes;if(n.content)if(n.anchor&&!n.anchor.startsWith("st-")||(n.anchor="st-"+n.content.toString().replace(/( |<br>)/g,"-").replace(/[^\w\s-]/g,"")),n={level:n.level,content:n.content,anchor:n.anchor},0!==t.length)for(;;){const e=t[t.length-1];if(n.level<=e.level)return void t.push(n);if(!e.children)return void(e.children=[n]);t=e.children}else t.push(n)}(e,t)}function a(e){let t="";return e.forEach((e=>{t+=`<li><a href="#${e.anchor}">${e.content}</a>`,e.children&&(t+="<ul>"+a(e.children)+"</ul>"),t+="</li>"})),t}(0,n.registerBlockType)("semla/toc",{edit:function(e){let{attributes:n,setAttributes:s,isSelected:h}=e;const{title:u,toc:d}=n,f=(0,c.useSelect)((e=>{const t=e(l.store).getBlocks(),n=[];return t.forEach((e=>{i(e,n)})),0===n.length?"":a(n)}),[]);return(0,t.useEffect)((()=>{f!==d&&s({toc:f})}),[f]),(0,t.createElement)("div",(0,l.useBlockProps)(),(0,t.createElement)(l.InspectorControls,null,(0,t.createElement)(r.PanelBody,{title:"Help",initialOpen:!0},(0,t.createElement)("p",null,"Set the HTML anchor of the headings to change the name of the internal links (you can find this in the Settings for the header blocks under Advanced)."))),(0,t.createElement)("div",{id:"semla_toc"},(0,t.createElement)("nav",{id:"semla_toc-nav"},h&&(0,t.createElement)(r.TextControl,{placeholder:"Title",onChange:e=>s({title:e}),value:u,keepPlaceholderOnFocus:!0}),!h&&u&&(0,t.createElement)("h4",null,u),(0,t.createElement)(r.Disabled,null,o(d)))))},save:function(n){let{attributes:r}=n;const{title:c,toc:i}=r;return(0,t.createElement)("div",e({id:"semla_toc"},l.useBlockProps.save()),(0,t.createElement)("nav",{id:"semla_toc-nav"},c.trim().length>0&&(0,t.createElement)("h4",null,c.trim()),o(i)))}})})();