(()=>{"use strict";function e(){return e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(e[l]=n[l])}return e},e.apply(this,arguments)}const t=window.wp.element,n=window.wp.blocks,l=window.wp.blockEditor,o=window.wp.components,a=window.wp.data;class c extends t.Component{constructor(e){super(e),this.state={value:e.value,unsubscribe:null}}setToc(){const e=[];(0,a.select)("core/block-editor").getBlocks().filter((e=>"core/heading"===e.name||"core/columns"===e.name)).forEach((t=>{"core/columns"===t.name?this.getHeadingBlocksFromColumns(t,e):this.addToToc(t,e)}));const t=0===e.length?"":this.createHtml(e);this.setState({value:t})}getHeadingBlocksFromColumns(e,t){"core/columns"===e.name||"core/column"===e.name?e.innerBlocks.forEach((e=>{this.getHeadingBlocksFromColumns(e,t)})):"core/heading"===e.name&&this.addToToc(e,t)}addToToc(e,t){let n=e.attributes;if(n.content)if(n.anchor&&!n.anchor.startsWith("st-")||(n.anchor="st-"+n.content.toString().replace(/( |<br>)/g,"-").replace(/[^\w\s-]/g,"")),n={level:n.level,content:n.content,anchor:n.anchor},0!==t.length)for(;;){const e=t[t.length-1];if(n.level<=e.level)return void t.push(n);if(!e.children)return void(e.children=[n]);t=e.children}else t.push(n)}createHtml(e){let t="";return e.forEach((e=>{t+=`<li><a href="#${e.anchor}">${e.content}</a>`,e.children&&(t+="<ul>"+this.createHtml(e.children)+"</ul>"),t+="</li>"})),t}componentDidMount(){this.setToc();const e=(0,a.subscribe)((()=>{this.setToc()}));this.setState({unsubscribe:e})}componentWillUnmount(){this.state.unsubscribe()}componentDidUpdate(e,t){this.props.onChange&&this.state.value!==t.value&&this.props.onChange(this.state.value)}static Content(e){return(0,t.createElement)(t.RawHTML,null,'<ul id="semla_toc-list">'+e.value+"</ul>")}render(){return this.state.value?c.Content(this.state):(0,t.createElement)("p",{className:"semla__filler"},"Add a header to begin generating the table of contents")}}(0,n.registerBlockType)("semla/toc",{edit:function(e){let{attributes:n,setAttributes:a,isSelected:r}=e;return(0,t.createElement)("div",(0,l.useBlockProps)(),(0,t.createElement)(l.InspectorControls,null,(0,t.createElement)(o.PanelBody,{title:"Help",initialOpen:!0},(0,t.createElement)("p",null,"Set the HTML anchor of the headings to change the name of the internal links (you can find this in the Settings for the header blocks under Advanced)."))),(0,t.createElement)("div",{id:"semla_toc"},(0,t.createElement)("nav",{id:"semla_toc-nav"},r&&(0,t.createElement)(o.TextControl,{placeholder:"Title",onChange:e=>a({title:e}),value:n.title,keepPlaceholderOnFocus:!0}),!r&&n.title&&(0,t.createElement)("h4",null,n.title),(0,t.createElement)(c,{value:n.toc,onChange:e=>a({toc:e})}))))},save:function(n){let{attributes:o}=n;return(0,t.createElement)("div",e({id:"semla_toc"},l.useBlockProps.save()),(0,t.createElement)("nav",{id:"semla_toc-nav"},o.title.trim().length>0&&(0,t.createElement)("h4",null,o.title.trim()),(0,t.createElement)(c.Content,{value:o.toc})))}})})();