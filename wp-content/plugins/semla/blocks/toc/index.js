(()=>{"use strict";const e=window.React,t=window.wp.blocks,n=window.wp.blockEditor,l=window.wp.components,c=window.wp.data,o=window.wp.element;function r(t){return(0,e.createElement)(o.RawHTML,null,'<ul id="semla_toc-list">'+t+"</ul>")}function i(e,t){"core/heading"!==e.name?e.innerBlocks.forEach((e=>{i(e,t)})):function(e,t){let n=e.attributes;if(n.content)if(n.anchor&&!n.anchor.startsWith("st-")||(n.anchor="st-"+n.content.toString().replace(/( |<br>)/g,"-").replace(/[^\w\s-]/g,"")),n={level:n.level,content:n.content,anchor:n.anchor},0!==t.length)for(;;){const e=t[t.length-1];if(n.level<=e.level)return void t.push(n);if(!e.children)return void(e.children=[n]);t=e.children}else t.push(n)}(e,t)}function a(e){let t="";return e.forEach((e=>{t+=`<li><a href="#${e.anchor}">${e.content}</a>`,e.children&&(t+="<ul>"+a(e.children)+"</ul>"),t+="</li>"})),t}(0,t.registerBlockType)("semla/toc",{edit:function({attributes:t,setAttributes:s,isSelected:h}){const{title:u,toc:d}=t,m=(0,c.useSelect)((e=>{const t=e(n.store).getBlocks(),l=[];return t.forEach((e=>{i(e,l)})),0===l.length?"":a(l)}),[]);return(0,o.useEffect)((()=>{m!==d&&s({toc:m})}),[m]),(0,e.createElement)("div",{...(0,n.useBlockProps)()},(0,e.createElement)(n.InspectorControls,null,(0,e.createElement)(l.PanelBody,{title:"Help",initialOpen:!0},(0,e.createElement)("p",null,"Set the HTML anchor of the headings to change the name of the internal links (you can find this in the Settings for the header blocks under Advanced)."))),(0,e.createElement)("div",{id:"semla_toc"},(0,e.createElement)("nav",{id:"semla_toc-nav"},h&&(0,e.createElement)(l.TextControl,{placeholder:"Title",onChange:e=>s({title:e}),value:u,keepPlaceholderOnFocus:!0}),!h&&u&&(0,e.createElement)("h4",null,u),(0,e.createElement)(l.Disabled,null,r(d)))))},save:function({attributes:t}){const{title:l,toc:c}=t;return(0,e.createElement)("div",{id:"semla_toc",...n.useBlockProps.save()},(0,e.createElement)("nav",{id:"semla_toc-nav"},l.trim().length>0&&(0,e.createElement)("h4",null,l.trim()),r(c)))}})})();