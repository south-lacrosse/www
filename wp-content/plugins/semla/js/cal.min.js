!function(){"use strict";var o="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),d="January_February_March_April_May_June_July_August_September_October_November_December".split("_");function t(){return gapi.client.calendar.events.list({calendarId:window.semla.cid,eventTypes:["default"],timeZone:"Europe/London",singleEvents:!0,timeMin:(new Date).toISOString(),orderBy:"startTime",fields:"items(summary,start,end"+(window.semla.calEnhanced?",description,location":"")+")"})}function e(t){var r,m,t=t.result.items;t&&0!==t.length?(r=['<dl class="calendar">'],m="",t.forEach(function(t){var e,n=t.start.date||t.start.dateTime.substring(0,10),a=n.substring(0,8),a=(a!==m&&(r.push("<dt>"+d[parseInt(a.substring(5,7),10)-1]+" "+a.substring(0,4)+"</dt>"),m=a),parseInt(n.substring(8,10),10)),s=new Date(n),s=o[s.getDay()]+" "+a+l(a),i=(t.start.dateTime?(s+=", ",a=c(t.start.dateTime),i=c(t.end.dateTime),n===(e=t.end.dateTime.substring(0,10))?(a.ampm===i.ampm&&(a.ampm=""),s+=a.time+a.ampm+"-"+i.time+i.ampm):s+=a.time+a.ampm+" - "+u(n,e)+", "+i.time+i.ampm):((a=new Date(t.end.date)).setTime(a.getTime()-864e5),(e=a.toISOString().split("T")[0])!==n&&(s+=" - "+u(n,e))),t.summary),a="";window.semla.calEnhanced&&1<(n=i.split(":")).length&&(i=n[0].trim(),a=' <mark class="tag',e=n[1].trim(),window.semla.calTags&&window.semla.calTags[e]&&(a+=" semla__tag"+window.semla.calTags[e]),a+='">'+e+"</mark>"),t.description?(n=function(t){t=t.match(/(\b(https?):\/\/[-A-Z0-9+&@#/%?=~_|!:,.;]*[-A-Z0-9+&@#/%=~_|])/i);return!!t&&t[0]}(t.description))&&(i='<a href="'+n+'">'+i+"</a>"):i="<b>"+i+"</b>",s+=" - "+i,t.location&&(s+=" "+t.location),r.push("<dd>"+(s+=a)+"</dd>")}),r.push("</dl>"),a(r.join(""))):a("<p>No pending events.</p>")}function n(t){console.log(t),a("<p>Error: "+t.result.error.message+"</p>")}function l(t){return 1===parseInt(t%100/10,10)?"th":1==(t=t%10)?"st":2==t?"nd":3==t?"rd":"th"}function c(t){var e,n=parseInt(t.substring(11,13),10),t=t.substring(14,16),n=(11<n?(e="pm",12<n&&(n-=12)):e="am",""+n);return"00"!==t&&(n+=":"+t),{time:n,ampm:e}}function u(t,e){var n=new Date(e),a=parseInt(e.substring(8,10),10),n=o[n.getDay()]+" "+a+l(a),a=e.substring(5,7),a=(a!==t.substring(5,7)&&(n+=" "+d[parseInt(a,10)-1]),e.substring(0,4));return a!==t.substring(0,4)&&(n+=" "+a),n}function a(t){var e=document.getElementById("semla_cal");e?e.innerHTML=t:console.log("Error: no div with id semla_cal")}gapi.load("client",function(){gapi.client.init({apiKey:window.semla.gapi,discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"]}).then(t).then(e,n)})}();