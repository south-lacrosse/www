(()=>{"use strict";const e=window.wp.blocks,t=window.wp.blockEditor,n=window.wp.components,i=window.wp.data,o=window.wp.element,c=window.ReactJSXRuntime;function r(e){return(0,c.jsx)(o.RawHTML,{children:'<ul id="semla_toc-list">'+e+"</ul>"})}function l(e,t){"core/heading"!==e.name?e.innerBlocks.forEach(e=>{l(e,t)}):e.attributes.anchor?function(e,t){const n=e.attributes;if(!n.content||!n.content.text)return;const i=n.content.toString().replace(/<[^>]+>/g,"").replace(/  +/g," "),o={level:n.level,content:i,anchor:n.anchor};if(0!==t.length)for(;;){const e=t[t.length-1];if(o.level<=e.level)return void t.push(o);if(!e.children)return void(e.children=[o]);t=e.children}else t.push(o)}(e,t.tree):t.headingsWithoutAnchor++}function s(e){let t="";return e.forEach(e=>{t+=`<li><a href="#${e.anchor}">${e.content}</a>`,e.children&&(t+="<ul>"+s(e.children)+"</ul>"),t+="</li>"}),t}(0,e.registerBlockType)("semla/toc",{edit:function({attributes:e,setAttributes:h,isSelected:a}){const{title:d,toc:u}=e,[w,p]=(0,i.useSelect)(e=>{const n=e(t.store).getBlocks(),i={tree:[],headingsWithoutAnchor:!1};return n.forEach(e=>{l(e,i)}),[0===i.tree.length?"":s(i.tree),i.headingsWithoutAnchor]},[]);return(0,o.useEffect)(()=>{w!==u&&h({toc:w})},[w]),(0,c.jsxs)("div",{...(0,t.useBlockProps)(),children:[(0,c.jsx)(t.InspectorControls,{children:(0,c.jsx)(n.PanelBody,{title:"Help",initialOpen:!0,children:(0,c.jsx)("p",{children:"Add heading blocks and set their HTML anchor to add to the table of contents (you can find this in the block Settings under Advanced). The anchor will become the name of the internal link. Open the Document Overview to see all the blocks and their anchors."})})}),(0,c.jsx)("div",{id:"semla_toc",children:(0,c.jsxs)("nav",{id:"semla_toc-nav",children:[a&&(0,c.jsx)(n.TextControl,{placeholder:"Title",onChange:e=>h({title:e}),value:d,keepPlaceholderOnFocus:!0}),!a&&d&&(0,c.jsx)("h4",{children:d}),u?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.Disabled,{children:r(u)}),p&&(0,c.jsx)("p",{children:(0,c.jsxs)("i",{children:["There are ",p," ","headings without anchors which won't appear here."]})})]}):(0,c.jsx)("p",{children:"Start adding Heading blocks to create a table of contents. Headings with HTML anchors will be linked here."})]})})]})},save:function({attributes:e}){const{title:n,toc:i}=e;return(0,c.jsx)("div",{id:"semla_toc",...t.useBlockProps.save(),children:(0,c.jsxs)("nav",{id:"semla_toc-nav",children:[n.trim().length>0&&(0,c.jsx)("h4",{children:n.trim()}),r(i)]})})}})})();