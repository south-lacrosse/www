(()=>{"use strict";const e=window.wp.blocks,t=window.wp.blockEditor,o=window.wp.components,l=window.wp.data,n=window.wp.editor,a=window.wp.element,s="semla/map",i=window.wp.primitives,r=window.ReactJSXRuntime,c=(0,r.jsxs)(i.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 92.3 132.3",children:[(0,r.jsx)(i.Path,{fill:"#1a73e8",d:"M60.2 2.2C55.8.8 51 0 46.1 0 32 0 19.3 6.4 10.8 16.5l21.8 18.3L60.2 2.2z"}),(0,r.jsx)(i.Path,{fill:"#ea4335",d:"M10.8 16.5C4.1 24.5 0 34.9 0 46.1c0 8.7 1.7 15.7 4.6 22l28-33.3-21.8-18.3z"}),(0,r.jsx)(i.Path,{fill:"#4285f4",d:"M46.2 28.5c9.8 0 17.7 7.9 17.7 17.7 0 4.3-1.6 8.3-4.2 11.4 0 0 13.9-16.6 27.5-32.7-5.6-10.8-15.3-19-27-22.7L32.6 34.8c3.3-3.8 8.1-6.3 13.6-6.3"}),(0,r.jsx)(i.Path,{fill:"#fbbc04",d:"M46.2 63.8c-9.8 0-17.7-7.9-17.7-17.7 0-4.3 1.5-8.3 4.1-11.3l-28 33.3c4.8 10.6 12.8 19.2 21 29.9l34.1-40.5c-3.3 3.9-8.1 6.3-13.5 6.3"}),(0,r.jsx)(i.Path,{fill:"#34a853",d:"M59.1 109.2c15.4-24.1 33.3-35 33.3-63 0-7.7-1.9-14.9-5.2-21.3L25.6 98c2.6 3.4 5.3 7.3 7.9 11.3 9.4 14.5 6.8 23.1 12.8 23.1s3.4-8.7 12.8-23.2"})]}),d={to:[{type:"block",blocks:["semla/location"],transform:(t,o)=>(0,e.createBlock)("semla/location",{},[(0,e.createBlock)(s,t,o)])}]},m=["core/image","core/paragraph"];(0,e.registerBlockType)(s,{icon:c,edit:function({clientId:e,attributes:s,setAttributes:i,isSelected:c}){const{lat:d,long:h}=s,[{lat:w,long:x},b]=(0,a.useState)({lat:d,long:h}),[g,j]=(0,a.useState)(!1),k=(0,l.useSelect)((o=>{const l=o(t.store).getBlockParentsByBlockName(e,"semla/location");return 0!==l.length?l[0]:null}),[e]),f=()=>{window.semla=window.semla||{},window.semla.loc={lat:d,long:h,address:k?(0,l.select)(t.store).getBlockAttributes(k).address:null},j(!0)};return(0,r.jsxs)("div",{...(0,t.useBlockProps)(),children:[(0,r.jsx)(t.BlockControls,{children:(0,r.jsx)(o.ToolbarGroup,{children:(0,r.jsx)(o.ToolbarButton,{icon:(0,r.jsx)(o.Icon,{icon:"location-alt"}),label:"Set coordinates on map",onClick:f})})}),(0,r.jsxs)(t.InspectorControls,{children:[(0,r.jsx)(o.PanelBody,{title:"Help",initialOpen:!1,children:(0,r.jsx)("p",{children:"Enter directions below the map so they are hidden when the page initially loads. Since 99.9% of people have have a SatNav on their phones only add anything if the route is complicated, or things like the postcode taking people to the wrong place. And if possible add information about public transport."})}),(0,r.jsxs)(o.PanelBody,{title:"Settings",children:[(0,r.jsx)(o.Button,{variant:"secondary",onClick:f,children:"Set coordinates on map"}),(0,r.jsx)("p",{style:{"margin-top":"0.25em"},children:"(the map will start at the current location, or if the Map is inside a Location block with an address then it will start there)"}),(0,r.jsx)("p",{children:"If you know the exact coordinates enter them below."}),(0,r.jsx)(o.TextControl,{label:"Latitude",type:"number",value:w,min:50,max:54,onChange:e=>b({lat:e?parseFloat(e):e,long:x})}),(0,r.jsx)(o.TextControl,{label:"Longitude",type:"number",value:x,min:-6,max:2,onChange:e=>b({lat:w,long:e?parseFloat(e):e})}),(0,r.jsx)(o.Button,{variant:"secondary",disabled:isNaN(w)||w<50||w>54||isNaN(x)||x<-6||x>2,onClick:()=>{i({lat:w,long:x,latLong:u(w,x)})},children:"Update Coordinates"}),(0,r.jsx)(o.Button,{variant:"secondary",onClick:()=>{b({lat:d,long:h})},children:"Reset"})]})]}),g&&(0,r.jsxs)(o.Modal,{onRequestClose:()=>j(!1),title:"Set Location on Map",className:"semla-map-modal",shouldCloseOnClickOutside:!1,children:[(0,r.jsx)("iframe",{title:"Map",id:"semla-map-iframe",src:p()+"../../modal/map-dialog.html"}),(0,r.jsxs)("div",{role:"group",className:"semla-map-buttons",children:[(0,r.jsx)(o.Button,{variant:"primary",onClick:()=>{const{lat:e,long:t}=window.semla.loc;i({lat:e,long:t,latLong:u(e,t)}),b({lat:e,long:t}),j(!1)},children:"OK"}),(0,r.jsx)(o.Button,{variant:"secondary",onClick:()=>j(!1),children:"Cancel"})]}),(0,r.jsx)("p",{className:"semla-map-instructions",children:"Drag the marker or double-click to set the exact position. You can also use the search box to search for a location."})]}),(0,r.jsxs)("div",{className:"semla-border semla-border-dashed",children:[null===k&&c&&(0,r.jsxs)("p",{className:"no-top-margin",children:[(0,r.jsx)("strong",{children:"WARNING:"})," This is a standalone map. Transform it to a Location block for a club or venue address with a map."]}),(0,r.jsx)("button",{className:"acrd-btn",children:"Map and Directions (will start hidden on live page)"}),d&&h?(0,r.jsxs)("p",{className:"semla-border semla-border-dashed",style:{"margin-top":"0.5em","padding-bottom":"0.5em"},children:["A Google map at ",`${d},${h}`,' will be inserted here - check the preview to see the actual rendering, or click "Set coordinates on map" in the toolbar or block settings to see the location.',(0,r.jsx)("br",{}),(0,r.jsx)(n.PostPreviewButton,{className:"is-secondary",textContent:"Open preview in new tab"})]}):(0,r.jsx)("p",{className:"semla-border semla-border-dashed",style:{"margin-top":"0.5em",color:"red","font-weight":"bold"},children:"NO COORDINATES SET"}),(0,r.jsx)(t.InnerBlocks,{allowedBlocks:m})]})]})},save:function(){return(0,r.jsx)(t.InnerBlocks.Content,{})},transforms:d});let h=null;function p(){if(null===h){const e=document.currentScript||document.querySelector('script[src*="semla/blocks/"]');if(e){const t=e.src;h=t.substring(0,t.lastIndexOf("/")+1)}}return h}function u(e,t){return isNaN(e)||isNaN(t)||e<50||e>54||t<-6||t>2?null:e.toFixed(6)+"%2C"+t.toFixed(6)}})();